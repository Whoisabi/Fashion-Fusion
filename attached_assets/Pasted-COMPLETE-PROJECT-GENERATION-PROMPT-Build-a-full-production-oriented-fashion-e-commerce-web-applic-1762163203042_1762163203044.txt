COMPLETE PROJECT GENERATION PROMPT
Build a full, production-oriented **fashion e-commerce web application** with frontend, backend, database, admin panel, and complete Docker configuration. The system must be runnable with `docker-compose up --build` and fully functional for both customers and admins. Follow the specs below exactly.

---

### 1️⃣ OVERVIEW

- Build a **responsive fashion e-commerce** platform with both customer and admin interfaces.
- Customers can browse fashion products (clothing, shoes, accessories), add to cart, checkout, and pay using **eSewa** or **Khalti** (sandbox integration).
- Admins can securely log in to a **dashboard** to add, edit, delete, and bulk upload products, with changes reflected immediately on the customer UI.
- Backend provides REST APIs (Node.js + Express + TypeScript) connected to PostgreSQL (Prisma ORM) and Redis.
- Frontend (React + Vite + Tailwind + TypeScript) has routes for both user-facing shop and admin panel.
- Containerized via Docker with multi-stage builds and `docker-compose.yml` for backend, frontend, database, and Redis.
- Include a README and setup docs.

---

### 2️⃣ TECH STACK

**Frontend (Customer + Admin):**
- React + Vite + TypeScript
- Tailwind CSS (mobile-first, responsive)
- React Router (routing)
- React Query for API data
- React Hook Form + Zod (form validation)
- Toast notifications (sonner or react-hot-toast)
- Axios for API requests
- Admin Dashboard at `/admin` with:
  - Admin login (JWT-protected)
  - Product management (create, edit, delete, bulk CSV upload)
  - Product list with image upload (via Cloudinary or local `/uploads`)
  - Real-time reflection on frontend product list

**Backend:**
- Node.js + Express + TypeScript
- Prisma ORM + PostgreSQL
- Redis (sessions / caching)
- Authentication:
  - JWT-based (access + refresh)
  - Role-based access (Admin, Customer)
- Validation: Zod
- Security: Helmet, express-rate-limit, CORS, bcrypt for passwords
- Logging: pino or winston
- Payment Gateways:
  - **eSewa** and **Khalti** integration (sandbox/test)
  - Endpoints for initiating, verifying, and handling callbacks/webhooks

**Database (PostgreSQL Schema via Prisma):**
- User { id, name, email (unique), passwordHash, role (enum: 'ADMIN' | 'CUSTOMER'), createdAt, updatedAt }
- Category { id, name, slug }
- Product { id, title, description, price, currency, stock, categoryId, images (string[]), slug, createdAt, updatedAt }
- ProductVariant { id, productId, sku, attributes (json), stock, priceAdjustment }
- Cart { id, userId, createdAt, updatedAt }
- CartItem { id, cartId, productId, quantity, priceAtAdd }
- Address { id, userId, label, city, state, country, postalCode, phone }
- Order { id, userId, total, status (enum: pending, paid, failed, shipped, cancelled), createdAt, updatedAt }
- OrderItem { id, orderId, productId, qty, price }
- Payment { id, orderId, gateway (enum: esewa, khalti), status, gatewayPaymentId, rawResponse (json), verifiedAt }

---

### 3️⃣ FEATURES & FUNCTIONALITY

**Customer Features:**
- Browse categories, view product detail page with gallery
- Search & filter products
- Add to cart, update quantities, remove items
- Checkout with address form and gateway choice (eSewa / Khalti)
- Order tracking and history
- Authentication (signup, login, logout, refresh)
- Responsive design (mobile → desktop)

**Admin Features:**
- Admin login (role-based access control)
- Dashboard showing:
  - Product management (CRUD)
  - Bulk CSV upload option
  - Image upload (local or Cloudinary)
  - Category management
  - Order list and status management (mark as shipped, cancelled)
- All changes should immediately reflect in frontend (via revalidation or cache invalidation)

---

### 4️⃣ PAYMENTS (eSewa + Khalti Sandbox)

**eSewa:**
- Backend endpoint to generate payment URL/form for sandbox:
  - Verify with server-to-server API call after redirect or webhook
  - Sample URLs:
    - Payment URL: https://uat.esewa.com.np/epay/main
    - Verification URL: https://uat.esewa.com.np/epay/transrec
- Env variables:
  - ESEWA_MERCHANT_ID, ESEWA_MERCHANT_SECRET

**Khalti:**
- Backend endpoint to initiate and verify payment via:
  - https://a.khalti.com/api/v2/payment/verify/
  - Use sandbox keys
- Env variables:
  - KHALTI_PUBLIC_KEY, KHALTI_SECRET_KEY

---

### 5️⃣ DOCKER & DEPLOYMENT

**Dockerfiles:**
- `backend/Dockerfile` → multi-stage (build, production)
- `frontend/Dockerfile` → multi-stage (build, nginx)
  
**docker-compose.yml:**
Includes:
- postgres
- redis
- backend (depends_on: postgres, redis)
- frontend (depends_on: backend)
- optional: pgadmin

Expose:
- Backend → port 4000
- Frontend → port 5173

**Multi-Stage Backend Example:**
```Dockerfile
# build stage
FROM node:20-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# production stage
FROM node:20-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY package*.json ./
RUN npm ci --omit=dev
EXPOSE 4000
CMD ["node", "dist/index.js"]


Multi-Stage Frontend Example:

FROM node:20-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

6️⃣ CONFIG & ENV

.env.example:

DATABASE_URL=postgresql://postgres:postgres@postgres:5432/fashiondb
REDIS_URL=redis://redis:6379
JWT_ACCESS_SECRET=changeme123
JWT_REFRESH_SECRET=changemerefresh123
ESEWA_MERCHANT_ID=test_merchant
ESEWA_MERCHANT_SECRET=test_secret
KHALTI_PUBLIC_KEY=test_public
KHALTI_SECRET_KEY=test_secret
NODE_ENV=production
PORT=4000

7️⃣ QUALITY & TESTS

ESLint + Prettier + Husky pre-commit hooks

Jest unit tests (auth, payments)

Playwright/Cypress E2E test (checkout flow simulation)

Healthcheck /health endpoint for DB + Redis

Structured logging (pino)

Secure headers, input validation, and error handling middleware

8️⃣ README & DOCUMENTATION

Must include:

Project overview and architecture diagram (ASCII)

Quickstart (git clone, .env, docker-compose up --build)

How to run migrations and seed data (npx prisma migrate dev)

How to upload products via Admin panel (step-by-step)

How to get sandbox keys for eSewa & Khalti

Endpoint documentation (auth, products, checkout, webhooks)

How to run tests and CI pipeline (GitHub Actions workflow)

9️⃣ ACCEPTANCE CRITERIA

After docker-compose up --build:

Backend and frontend containers start successfully.

Admin can log in, add/edit/delete products.

Customer can register, browse products, add to cart, and checkout.

Payments work in sandbox mode for eSewa/Khalti.

Orders and payments are recorded in PostgreSQL.

All API routes protected with JWT, with role-based access (admin vs customer).

Application fully responsive across devices.

Now generate the complete repository structure and code for this fashion e-commerce platform — including:

Full file tree

Frontend (React + Vite + Tailwind) pages

Backend (Express + TypeScript + Prisma)

Prisma schema

Dockerfiles (frontend + backend)

docker-compose.yml

.env.example

README.md

One sample backend test file (Jest)

One sample frontend test (Vitest)

Minimal but functional admin panel UI
Do not include extra commentary — only the files and their contents.